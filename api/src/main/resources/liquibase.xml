<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">


    <changeSet id="ohri-mamba-setup0001" author="Arthur D. Mugume [OHRI]" runAlways="true">

        <comment>
            Installs/deploys all the required Mamba ETL Stored procedures and functions
        </comment>

        <sqlFile splitStatements="true" stripComments="true" endDelimiter="~"
                 path="mamba/liquibase_create_stored_procedures.sql"/>

    </changeSet>
    <changeSet id="20230811-1312" author="dbaluku">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM scheduler_task_config
                WHERE schedulable_class = 'org.openmrs.module.ohrimamba.task.FlattenTableTask'
            </sqlCheck>
        </preConditions>
        <comment>Updating schedulable_class for flattening tables </comment>
        <sql>
            UPDATE scheduler_task_config SET schedulable_class = 'org.openmrs.module.ohrimamba.task.FlattenTableTask' WHERE schedulable_class = 'org.openmrs.module.ugandaemrsync.tasks.ComputeAndSaveAuditToolDataTask';
        </sql>
    </changeSet>

</databaseChangeLog>